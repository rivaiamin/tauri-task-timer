<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Task Timer</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font, a clean sans-serif */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Add a custom font import for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8">
        
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-gray-900 text-center">Task Timer</h1>
            <p class="text-center text-gray-500 mt-1">Add tasks and track your time. Only one timer can run at a time.</p>
        </header>

        <!-- Add New Task Form -->
        <form id="task-form" class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mb-8">
            <input 
                type="text" 
                id="task-input" 
                placeholder="Enter new task name..." 
                class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
            <button 
                type="submit" 
                class="p-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition duration-200 shadow-sm"
            >
                Add Task
            </button>
        </form>

        <!-- Task List Container -->
        <div id="task-list" class="space-y-4">
            <!-- Tasks will be dynamically inserted here -->
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const taskForm = document.getElementById('task-form');
            const taskInput = document.getElementById('task-input');
            const taskList = document.getElementById('task-list');

            // --- State Management ---
            // Load tasks from localStorage or initialize as empty array
            let tasks = loadTasks();

            // --- Core Functions ---

            /**
             * Renders the entire list of tasks to the DOM
             */
            function renderTasks() {
                // Clear the current list
                taskList.innerHTML = '';

                if (tasks.length === 0) {
                    taskList.innerHTML = `<p class="text-gray-500 text-center">No tasks added yet. Add one above to get started!</p>`;
                    return;
                }

                tasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = `flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 ${task.isRunning ? 'ring-2 ring-green-400' : ''}`;

                    const formattedTime = formatTime(task.elapsedTime);
                    const buttonText = task.isRunning ? 'Stop' : 'Start';
                    const buttonClass = task.isRunning 
                        ? 'bg-red-500 hover:bg-red-600' 
                        : 'bg-green-500 hover:bg-green-600';

                    taskElement.innerHTML = `
                        <!-- Left Side: Label and Time -->
                        <div class="flex-1 mb-3 sm:mb-0">
                            <span class="text-lg font-medium text-gray-900 break-words">${escapeHTML(task.label)}</span>
                            <span id="time-${task.id}" class="text-3xl font-mono text-gray-700 block mt-1">${formattedTime}</span>
                        </div>
                        
                        <!-- Right Side: Buttons -->
                        <div class="flex space-x-2 w-full sm:w-auto">
                            <button 
                                data-id="${task.id}" 
                                data-action="toggle"
                                class="w-1/2 sm:w-20 p-2 rounded-lg text-white font-semibold transition duration-200 ${buttonClass}"
                            >
                                ${buttonText}
                            </button>
                            <button 
                                data-id="${task.id}"
                                data-action="delete"
                                class="w-1/2 sm:w-20 p-2 rounded-lg text-white font-semibold bg-gray-400 hover:bg-gray-500 transition duration-200"
                            >
                                Delete
                            </button>
                        </div>
                    `;
                    taskList.appendChild(taskElement);
                });
            }

            /**
             * Toggles a timer on or off.
             * If starting a timer, stops all other running timers.
             */
            function toggleTimer(id) {
                const taskToToggle = tasks.find(task => task.id === id);
                if (!taskToToggle) return;

                const isStarting = !taskToToggle.isRunning;

                // Stop all other running timers
                if (isStarting) {
                    tasks.forEach(task => {
                        if (task.isRunning) {
                            clearInterval(task.intervalId);
                            task.isRunning = false;
                            task.intervalId = null;
                        }
                    });
                }

                // Toggle the target task
                if (isStarting) {
                    // Start this task
                    taskToToggle.isRunning = true;
                    taskToToggle.intervalId = setInterval(() => {
                        taskToToggle.elapsedTime++;
                        // Update the time display directly without full re-render
                        const timeElement = document.getElementById(`time-${taskToToggle.id}`);
                        if (timeElement) {
                            timeElement.textContent = formatTime(taskToToggle.elapsedTime);
                        }
                        saveTasks(); // Save on every tick
                    }, 1000);
                } else {
                    // Stop this task
                    clearInterval(taskToToggle.intervalId);
                    taskToToggle.isRunning = false;
                    taskToToggle.intervalId = null;
                }

                saveTasks();
                renderTasks(); // Re-render to update button styles and ring
            }

            /**
             * Deletes a task from the list
             */
            function deleteTask(id) {
                const taskToDelete = tasks.find(task => task.id === id);
                if (taskToDelete && taskToDelete.isRunning) {
                    clearInterval(taskToDelete.intervalId);
                }
                
                tasks = tasks.filter(task => task.id !== id);
                saveTasks();
                renderTasks();
            }

            /**
             * Adds a new task to the list
             */
            function addTask(e) {
                e.preventDefault();
                const label = taskInput.value.trim();
                if (!label) return;

                const newTask = {
                    id: Date.now(),
                    label: label,
                    elapsedTime: 0, // in seconds
                    isRunning: false,
                    intervalId: null
                };

                tasks.push(newTask);
                taskInput.value = ''; // Clear input
                saveTasks();
                renderTasks();
            }

            // --- Utility Functions ---

            /**
             * Saves the current tasks array to localStorage
             */
            function saveTasks() {
                // Don't save intervalId, as it's not serializable
                const tasksToSave = tasks.map(task => ({
                    id: task.id,
                    label: task.label,
                    elapsedTime: task.elapsedTime
                }));
                localStorage.setItem('taskTimerApp', JSON.stringify(tasksToSave));
            }

            /**
             * Loads tasks from localStorage
             */
            function loadTasks() {
                const savedTasks = localStorage.getItem('taskTimerApp');
                if (savedTasks) {
                    // Re-initialize state, ensuring no timers are running on load
                    return JSON.parse(savedTasks).map(task => ({
                        ...task,
                        isRunning: false,
                        intervalId: null
                    }));
                }
                return [];
            }

            /**
             * Formats total seconds into HH:MM:SS string
             */
            function formatTime(totalSeconds) {
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                return [
                    String(hours).padStart(2, '0'),
                    String(minutes).padStart(2, '0'),
                    String(seconds).padStart(2, '0')
                ].join(':');
            }

            /**
             * Sanitizes HTML strings to prevent XSS
             */
            function escapeHTML(str) {
                const div = document.createElement('div');
                div.appendChild(document.createTextNode(str));
                return div.innerHTML;
            }

            // --- Event Listeners ---
            
            // Form submission
            taskForm.addEventListener('submit', addTask);

            // Event delegation for toggle and delete buttons
            taskList.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const id = Number(button.dataset.id);
                const action = button.dataset.action;

                if (action === 'toggle') {
                    toggleTimer(id);
                } else if (action === 'delete') {
                    // Simple confirmation
                    if (confirm('Are you sure you want to delete this task?')) {
                        deleteTask(id);
                    }
                }
            });

            // --- Initial Render ---
            renderTasks();
        });
    </script>
</body>
</html>